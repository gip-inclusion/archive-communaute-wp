window.bp=window.bp||{},function(i){bp.OneSignal_Common={start:function(){this.setupGlobals(),this.addListeners(),this.validateWebPush(),this.validateAutoPrompt(),this.validateSoftPrompt(),this.uploadAttachment()},setupGlobals:function(){jQuery(function(){bp.OneSignal_Common.validateWebPush(),bp.OneSignal_Common.validateAutoPrompt(),bp.OneSignal_Common.validateSoftPrompt()})},addListeners:function(){i(document).on("change","#bb-onesignal-enable-soft-prompt",this.validateSoftPrompt.bind(this)),i(document).on("change","#bb-onesignal-request-permission",this.validateRequestPermission.bind(this)),i(document).on("change","#bb-onesignal-enabled-web-push",this.enableWebPush.bind(this)),i(document).on("change","#bb-onesignal-connected-app",this.updateAppName.bind(this)),i(document).on("click",".bb-onesignal-enable-soft-prompt .bb-learn-more",this.softPromptLearnMore.bind(this)),i(document).on("click","#bb-onesignal-create-new-app",this.createNewApp.bind(this)),i(document).on("keyup","#bb-onesignal-enable-soft-prompt-message",this.updateSoftPromptMessage.bind(this)),i(document).on("keyup","#bb-onesignal-enable-soft-prompt-allow-button",this.updateSoftPromptAllowButton.bind(this)),i(document).on("keyup","#bb-onesignal-enable-soft-prompt-cancel-button",this.updateSoftPromptCancelButton.bind(this))},validateSoftPrompt:function(){jQuery("#bb-onesignal-request-permission").is(":checked")&&jQuery("#bb-onesignal-enabled-web-push").is(":checked")&&i("#bb-onesignal-enable-soft-prompt").is(":checked")?i(".bb-onesignal-enable-soft-prompt-extra-fields").removeClass("bp-hide"):i(".bb-onesignal-enable-soft-prompt-extra-fields").addClass("bp-hide")},validateRequestPermission:function(e){i(e.currentTarget).is(":checked")?i('select[name="bb-onesignal-permission-validate"]').prop("disabled",!1):i('select[name="bb-onesignal-permission-validate"]').prop("disabled",!0),bp.OneSignal_Common.validateAutoPrompt()},enableWebPush:function(){bp.OneSignal_Common.validateWebPush()},updateAppName:function(e){var t=i(e.currentTarget).find("option:selected").attr("data-name");i(document).find('input[name="bb-onesignal-connected-app-name"]').val(t)},validateWebPush:function(){jQuery("#bb-onesignal-enabled-web-push").is(":checked")?(jQuery(".bb-onesignal-request-permission, .bb-onesignal-default-notification-icon").removeClass("bp-hide"),jQuery("#bb-onesignal-request-permission").is(":checked")?(jQuery(".bb-onesignal-enable-soft-prompt").removeClass("bp-hide"),jQuery("#bb-onesignal-enable-soft-prompt").is(":checked")&&jQuery(".bb-onesignal-enable-soft-prompt-extra-fields").removeClass("bp-hide")):jQuery(".bb-onesignal-enable-soft-prompt, .bb-onesignal-enable-soft-prompt-extra-fields").addClass("bp-hide")):jQuery(".bb-onesignal-request-permission, .bb-onesignal-default-notification-icon, .bb-onesignal-enable-soft-prompt, .bb-onesignal-enable-soft-prompt-extra-fields").addClass("bp-hide")},validateAutoPrompt:function(){jQuery("#bb-onesignal-request-permission").is(":checked")&&jQuery("#bb-onesignal-enabled-web-push").is(":checked")?(jQuery(".bb-onesignal-enable-soft-prompt").removeClass("bp-hide"),jQuery("#bb-onesignal-enable-soft-prompt").is(":checked")&&jQuery(".bb-onesignal-enable-soft-prompt-extra-fields").removeClass("bp-hide")):jQuery(".bb-onesignal-enable-soft-prompt, .bb-onesignal-enable-soft-prompt-extra-fields").addClass("bp-hide")},softPromptLearnMore:function(){return i(".bb-onesignal-enable-soft-prompt .small-text").addClass("bp-hide"),i(".bb-onesignal-enable-soft-prompt .full-text").removeClass("bp-hide"),!1},createNewApp:function(){i(document).find("#bb-onesignal-new-app").val("1"),i(document).find("#bb-onesignal-create-new-app").addClass("loading")},updateSoftPromptMessage:function(e){var t=i(e.currentTarget),a=t.attr("placeholder"),n=t.val();n.length<1&&(n=a),i(".bb-onesignal-enable-soft-prompt-extra-fields .soft-prompt-text").text(n),bp.OneSignal_Common.validateCharacterLimit(e)},updateSoftPromptAllowButton:function(e){var t=i(e.currentTarget),a=t.attr("placeholder"),n=t.val();n.length<1&&(n=a),i(".bb-onesignal-enable-soft-prompt-extra-fields .allow-soft-prompt-button").text(n),bp.OneSignal_Common.validateCharacterLimit(e)},updateSoftPromptCancelButton:function(e){var t=i(e.currentTarget),a=t.attr("placeholder"),n=t.val();n.length<1&&(n=a),i(".bb-onesignal-enable-soft-prompt-extra-fields .cancel-soft-prompt-button").text(n),bp.OneSignal_Common.validateCharacterLimit(e)},uploadAttachment:function(){var s="";i(".bbpro-upload-attachment").on("click",".bb-attachment-user-edit",function(){var e=(s=i(this)).parents(".bbpro-upload-attachment").find(".bbpro-attachment-status");0<e.length&&e.find(".bbpro-attachment-upload-feedback").length&&(e.find(".bbpro-attachment-upload-feedback").removeClass("success error").html(""),e.hide()),setTimeout(function(){(0<jQuery(document).find("#TB_ajaxContent .bp-avatar-status .error").length||jQuery(document).find("#TB_ajaxContent .bp-avatar-status .warning").length<=0)&&(jQuery(document).find("#TB_ajaxContent .bp-avatar-status").empty(),jQuery(document).find("#TB_ajaxContent .bp-avatar-status").append('<p class="warning">'+BP_Uploader.strings.avatar_size_warning+"<br></p>"))},50)}),i(".bbpro-upload-attachment").on("click",".bb-attachment-user-edit, .bbpro-img-remove-button",function(){var e,t=i(this).parents(".bbpro-upload-attachment");0<t.length&&(e=t.data("object"),BP_Uploader.settings.defaults.multipart_params.bp_params.object=e)}),i(document).ajaxSuccess(function(e,t,a){var n,o,r;a.hasOwnProperty("data")&&"string"==typeof a.data&&0<a.data.search("action=bp_avatar_set")&&(0<a.data.search("object=notification")||0<a.data.search("object=prompt"))&&(n=JSON.parse(t.responseText),o=BP_Uploader.strings.default_error,void 0!==n.success&&!1===n.success&&(void 0!==n.data&&void 0!==n.data.feedback_code&&(o=BP_Uploader.strings.feedback_messages[n.data.feedback_code]),0<(r=s.parents(".bbpro-upload-attachment").find(".bbpro-attachment-status")).length&&r.find(".bbpro-attachment-upload-feedback").length&&(r.find(".bbpro-attachment-upload-feedback").removeClass("success error").addClass("error").html(o),r.show())),i(e.currentTarget.activeElement).find("#TB_closeWindowButton").trigger("click"),s.html(s.data("upload")))}),i(document).ajaxError(function(e,t,a){a.hasOwnProperty("data")&&"string"==typeof a.data&&0<a.data.search("action=bp_avatar_set")&&(0<a.data.search("object=notification")||0<a.data.search("object=prompt"))&&(i(e.currentTarget.activeElement).find("#TB_closeWindowButton").trigger("click"),s.html(s.data("upload")))}),i(document).ajaxSend(function(e,t,a){a.hasOwnProperty("data")&&"string"==typeof a.data&&0<a.data.search("action=bp_avatar_set")&&(0<a.data.search("object=notification")||0<a.data.search("object=prompt"))&&(i(document).find("#TB_closeWindowButton").trigger("click"),s.html(s.data("uploading")))});var e=document.querySelectorAll(".bbpro-attachment-upload-container .bb-upload-preview"),t=new MutationObserver(function(e){e.forEach(function(e){var t,a;e.attributeName.includes("src")&&(t=i(e.target).attr("src"),a=i(".soft-prompt-box-wrapper-preview .soft-prompt-image img"),""===t?(i(e.target).addClass("bp-hide"),i(e.target).next(".bb-default-custom-avatar-field").val(""),i(e.target).parents(".bbpro-upload-attachment").find(".bbpro-img-remove-button").addClass("bp-hide"),i(e.target).hasClass("prompt-0-avatar")&&a.attr("src",a.data("default"))):(i(e.target).removeClass("bp-hide"),i(e.target).next(".bb-default-custom-avatar-field").val(t),i(e.target).parents(".bbpro-upload-attachment").find(".bbpro-img-remove-button").removeClass("bp-hide"),i(e.target).hasClass("prompt-0-avatar")&&a.attr("src",t)))})});e.forEach(function(e){t.observe(e,{attributes:!0})}),i(".bbpro-upload-attachment").on("click","a.bbpro-img-remove-button",function(e){var a,t,n,o,r,s;e.preventDefault(),confirm(BP_Confirm.are_you_sure)&&(t=(a=i(this)).parents("tr"),n=t.find(".bbpro-upload-attachment"),o=t.find(".bbpro-attachment-status"),r=BP_Uploader.settings.defaults.multipart_params.bp_params.item_id,s=BP_Uploader.settings.defaults.multipart_params.bp_params.object,a.html(a.data("removing")),o.hide(),o.find(".bp-feedback").removeClass("success error"),bp.ajax.post("bp_avatar_delete",{json:!0,item_id:r,item_type:BP_Uploader.settings.defaults.multipart_params.bp_params.item_type,object:s,nonce:BP_Uploader.settings.defaults.multipart_params.bp_params.nonces.remove}).done(function(e){a.html(a.data("remove")),i("."+s+"-"+e.item_id+"-avatar").each(function(){i(this).prop("src",e.avatar)}),n.find(".bb-upload-container img").prop("src",e.avatar).addClass("bp-hide"),setTimeout(function(){n.find(".bbpro-img-remove-button").length&&n.find(".bbpro-img-remove-button").addClass("bp-hide")},50)}).fail(function(e){var t=BP_Uploader.strings.default_error;a.html(a.data("remove")),_.isUndefined(e)||(t=BP_Uploader.strings.feedback_messages[e.feedback_code]),o.find(".bp-feedback").removeClass("success error").addClass("error").find("p").html(t),o.show()}))})},validateCharacterLimit:function(e){var t=i(e.currentTarget),a=t.val().length;t.parent().find(".description .current").text(a),0===a?t.parent().find(".description:not(.soft_prompt_label_header)").addClass("bp-hide"):t.parent().find(".description:not(.soft_prompt_label_header)").removeClass("bp-hide")}},bp.OneSignal_Common.start()}((bp,jQuery));