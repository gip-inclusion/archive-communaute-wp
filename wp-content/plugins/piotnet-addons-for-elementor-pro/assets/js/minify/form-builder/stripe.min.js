!function(n){function e(e,C){(e=e.find("[data-pafe-form-builder-stripe]")).length&&C.each(e,function(e,t){var a=C("[data-pafe-stripe]").data("pafe-stripe");if(void 0!==a){var o=Stripe(a),i=C(this).attr("data-pafe-form-builder-stripe-font-family"),a=o.elements({fonts:[{cssSrc:i}]}),i=C(this).attr("data-pafe-form-stripe-custom-style");if(i)var r=JSON.parse(i);else{let e=C(this).attr("data-pafe-form-builder-stripe-style");e=JSON.parse(e);r={base:{backgroundColor:e.backgroundColor,color:e.color,fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:e.fontSize,"::placeholder":{color:e.placeholderColor}},invalid:{color:"#fa755a",iconColor:"#fa755a"}};e.iconColor&&(r.base.iconColor=e.iconColor)}var n=a.create("card",{style:r});n.mount(t);C(t).data("pafe-form-builder-form-id")}C(document).on("click","[data-pafe-form-builder-submit-form-id][data-pafe-form-builder-stripe-submit]",function(){var g,e,_,v,y,k,x,d,l;null!=C(this).data("pafe-form-builder-stripe-submit")&&(g=C(this).data("pafe-form-builder-submit-form-id"),e=C(document).find("[data-pafe-form-builder-form-id="+g+"]"),_=C(this).data("pafe-form-builder-required-text"),v=[],y=0,k=new FormData,x=!1,d=C(this),l=d.closest(".elementor-element"),e.each(function(){if(null==C(this).data("pafe-form-builder-stripe")&&null==C(this).data("pafe-form-builder-html")){var e=C(this).closest(".elementor-field-type-checkbox.elementor-field-required"),t=0;0<e.length&&(t=e.find("input[type=checkbox]:checked").length),null!=C(this).attr("oninvalid")&&(_=C(this).attr("oninvalid").replace("this.setCustomValidity('","").replace("')","")),null!=C(this).attr("data-pafe-is-repassword")&&""!=C(this).attr("data-pafe-is-repassword")&&(i=C('[name="form_fields['+C(this).attr("data-pafe-is-repassword")+']"]').val(),r=C(this).attr("data-pafe-repassword-msg"),String(i)!==String(C(this).val())?(this.setCustomValidity(r),y++,C(this).on("keyup",function(){this.setCustomValidity("")})):this.setCustomValidity("")),void 0!==C(this).attr("data-pafe-confirm-field")&&!1!==C(this).attr("data-pafe-confirm-field")&&(o=C('[name="form_fields['+C(this).attr("data-pafe-confirm-field")+']"]').val(),s=C(this).attr("data-pafe-confirm-msg"),String(o)!==String(C(this).val())?(this.setCustomValidity(s),y++,C(this).on("keyup",function(){this.setCustomValidity("")})):this.setCustomValidity(""));var i=C(this)[0].checkValidity(),r=C(C(this)[0]).next()[0];if(C(r).hasClass("flatpickr-mobile")&&(i=r.checkValidity()),!i&&0==C(this).closest(".pafe-form-builder-conditional-logic-hidden").length&&"none"!=C(this).closest("[data-pafe-form-builder-conditional-logic]").css("display")&&0==C(this).closest("[data-pafe-signature]").length||0==t&&0<e.length&&"none"!=C(this).closest(".elementor-element").css("display"))"none"==C(this).css("display")||null!=C(this).data("pafe-form-builder-image-select")||null!=C(this).data("pafe-form-builder-select-autocomplete")||0<e.length?C(this).closest(".elementor-field-group").find("[data-pafe-form-builder-required]").html(_):x||null!=C(this).data("pafe-form-builder-image-select")||(C(this)[0].reportValidity(),x=!0),y++;else if(""==C(this).val()&&0==C(this).closest(".pafe-form-builder-conditional-logic-hidden").length&&"true"==C(this).attr("aria-required")&&void 0!==C(this).attr("data-pafe-form-builder-select-autocomplete"))C(this).closest(".elementor-field-group").find("[data-pafe-form-builder-required]").html(_),y++;else{null!=C(this).data("pafe-form-builder-image-select")&&(C(this).closest(".pafe-image-select-field").find(".image_picker_selector").find(".selected").length<C(this).data("pafe-form-builder-image-select-min-select")?(C(this).closest(".elementor-field-group").find("[data-pafe-image_select_min_select_check]").html(C(this).data("pafe-form-builder-image-select-min-select-message")),y++):C(this).closest(".elementor-field-group").find("[data-pafe-image_select_min_select_check]").remove()),C(this).closest(".elementor-field-group").find("[data-pafe-form-builder-required]").html(""),null!=C(this).data("pafe-flatpickr-custom-options")&&""==C(this).val()&&0==C(this).closest(".pafe-form-builder-conditional-logic-hidden").length&&null!=C(this).attr("required")&&(C(this).closest(".elementor-field-group").find("[data-pafe-form-builder-required]").html(_),y++),0<C(this).closest("[data-pafe-signature]").length&&(C(this).closest("[data-pafe-signature]").find("[data-pafe-signature-export]").trigger("click"),""==C(this).val()&&0==C(this).closest(".pafe-form-builder-conditional-logic-hidden").length&&"required"==C(this).attr("required")&&(C(this).closest(".elementor-field-group").find("[data-pafe-form-builder-required]").html(_),y++));var a,d=C(this).attr("type"),l=C(this).attr("name"),o=C(this).closest("[data-pafe-form-builder-repeater-form-id]"),n="",s="",r="",i=-1,t=0;if(0<o.length&&($repeaterParents=C(this).parents("[data-pafe-form-builder-repeater-form-id]"),s=o.data("pafe-form-builder-repeater-id"),$repeaterParents.each(function(){var e=C(this).data("pafe-form-builder-repeater-id"),t=C(document).find('[data-pafe-form-builder-repeater-form-id="'+g+'"][data-pafe-form-builder-repeater-id="'+e+'"]');repeaterParentIndex=C(this).index()-t.index(),n+=e+"|index"+repeaterParentIndex+"|"+l.replace("[]","").replace("form_fields[","").replace("]","")+","}),r=o.data("pafe-form-builder-repeater-label"),e=C(document).find('[data-pafe-form-builder-repeater-id="'+o.data("pafe-form-builder-repeater-id")+'"]'),t=o.siblings('[data-pafe-form-builder-repeater-id="'+o.data("pafe-form-builder-repeater-id")+'"]').length+1,i=o.index()-e.index()),"file"==d)if(C(this).hasClass("error"))y++;else{let a=[];var f,l=C(this).attr("id").replace("form-field-","");C.each(C(this)[0].files,function(e,t){a.push(t.name),k.append(l+"[]",t)}),(f={}).label=C(this).closest(".elementor-field-group").find(".elementor-field-label").html(),f.name=l,f.value="",f.type=C(this).attr("type"),f.upload=1,f.file_name=a,f.repeater_id=n,f.repeater_id_one=s,f.repeater_label=r,f.repeater_index=i,f.repeater_length=t,null!=C(this).data("pafe-form-builder-remove-this-field-from-repeater")&&(f.repeater_remove_this_field="1"),null!=C(this).data("pafe-form-builder-remove-this-field-from-repeater")&&(f.repeater_remove_this_field="1"),null!=C(this).data("attach-files")&&(f["attach-files"]=1),v.push(f)}else{if(-1!==l.indexOf("[]")){var m=[];"checkbox"==d?C(this).closest(".elementor-element").find('[name="'+l+'"]:checked').each(function(){m.push(C(this).val())}):null==(m=C(this).val())&&(m=[]);for(var p,c,u=a="",h=[],b=0;b<m.length;b++)null!=C(this).data("pafe-form-builder-send-data-by-label")&&(p=m[b],"checkbox"==d?0<(c=C(this).closest(".elementor-element").find('[value="'+p+'"]')).length&&(u+=c.data("pafe-form-builder-send-data-by-label")+","):0<(c=C(this).find('[value="'+p+'"]')).length&&(u+=c.html()+",")),a+=m[b]+",",null!=C(this).attr("data-pafe-form-booking-item-options")&&(p=m[b],0<(c=C(this).closest(".elementor-element").find('[value="'+p+'"]')).length&&h.push(c.attr("data-pafe-form-booking-item-options")));a=a.replace(/,(\s+)?$/,"")}else"radio"==d||"checkbox"==d?(null!=C(this).data("pafe-form-builder-send-data-by-label")&&(u=C(this).closest(".elementor-element").find('[name="'+l+'"]:checked').data("pafe-form-builder-send-data-by-label")),a=(a=C(this).closest(".elementor-element").find('[name="'+l+'"]:checked').val())||""):null!=C(this).data("pafe-form-builder-calculated-fields")?a=C(this).siblings(".pafe-calculated-fields-form").text():(null!=C(this).data("pafe-form-builder-send-data-by-label")&&(null!==C(this).val()&&(p=C(this).val().trim()),0<(c=C(this).find('[value="'+p+'"]')).length&&(u=c.html())),null!==C(this).val()&&(a=C(this).val().trim()));null!=a&&((f={}).label=C(this).closest(".elementor-field-group").find(".elementor-field-label").html(),f.name=l.replace("[]","").replace("form_fields[","").replace("]",""),f.value=a,null!=m&&(f.value_multiple=m),f.type=C(this).attr("type"),void 0!==C(this).attr("data-pafe-form-builder-address-autocomplete")&&(f.lat=C(this).attr("data-pafe-form-builder-google-maps-lat"),f.lng=C(this).attr("data-pafe-form-builder-google-maps-lng"),f.zoom=C(this).attr("data-pafe-form-builder-google-maps-zoom")),void 0!==h&&0<h.length&&(f.booking=h),""!=u&&(f.value_label=u),0<C(this).closest(".elementor-field-type-calculated_fields").length&&(f.calculation_results=C(this).val().trim()),0==C(this).closest(".pafe-form-builder-conditional-logic-hidden").length&&(f.repeater_id=n,f.repeater_id_one=s,f.repeater_index=i,f.repeater_label=r,f.repeater_length=t,null!=C(this).data("pafe-form-builder-remove-this-field-from-repeater")&&(f.repeater_remove_this_field="1")),null!=C(this).attr("data-pafe-remove-value")&&"false"!=C(this).attr("data-pafe-remove-value")&&C(this).val()==C(this).attr("data-pafe-remove-value")&&(f.value=""),v.push(f))}}}}),0==y&&o.createToken(n).then(function(e){var i,t,a,r;e.error||(C(document).find('[data-pafe-form-builder-form-id="'+g+'"]').closest(".elementor-element").css({opacity:.45}),d.closest(".elementor-element").css({opacity:.45}),d.closest(".elementor-element").addClass("elementor-form-waiting"),l.find(".elementor-message").removeClass("visible"),i=0,null!=d.data("pafe-form-builder-stripe-amount")?i=d.data("pafe-form-builder-stripe-amount"):null!=d.data("pafe-form-builder-stripe-amount-field")&&(t=d.data("pafe-form-builder-stripe-amount-field").replace('[field id="',"").replace('"]',""),i=C(document).find('[data-pafe-form-builder-form-id="'+g+'"][name="form_fields['+t+']"]').val()),a="",null!=d.data("pafe-form-builder-stripe-customer-info-field")&&(t=d.data("pafe-form-builder-stripe-customer-info-field").replace('[field id="',"").replace('"]',""),a=C(document).find('[data-pafe-form-builder-form-id="'+g+'"][name="form_fields['+t+']"]').val()),C(document).find('input[name="post_id"][data-pafe-form-builder-hidden-form-id="'+g+'"]').eq(0).closest("[data-elementor-id]").data("elementor-id"),C(document).find('input[name="form_id"][data-pafe-form-builder-hidden-form-id="'+g+'"]').val(),e.token.id,k.append("action","pafe_ajax_stripe_intents"),k.append("post_id",l.find('input[name="post_id"]').closest("[data-elementor-id]").data("elementor-id")),k.append("form_id",l.find('input[name="form_id"]').val()),k.append("fields",JSON.stringify(v)),k.append("referrer",window.location.href),k.append("remote_ip",C(document).find('input[name="remote_ip"][data-pafe-form-builder-hidden-form-id="'+g+'"]').val()),k.append("stripeToken",e.token.id),k.append("amount",i),k.append("description",a),null!=C(this).data("pafe-form-builder-woocommerce-product-id")&&k.append("product_id",C(this).data("pafe-form-builder-woocommerce-product-id")),null!=d.data("pafe-form-builder-submit-post-edit")&&k.append("edit",d.data("pafe-form-builder-submit-post-edit")),null!=d.data("pafe-form-builder-submit-recaptcha")?(r=d.data("pafe-form-builder-submit-recaptcha"),grecaptcha.ready(function(){grecaptcha.execute(r,{action:"create_comment"}).then(function(e){k.append("recaptcha",e),o.createPaymentMethod("card",n,{}).then(function(e){e.error||(k.append("payment_method_id",e.paymentMethod.id),C.ajax({url:C("[data-pafe-ajax-url]").data("pafe-ajax-url"),type:"POST",data:k,processData:!1,contentType:!1,success:function(e){var t=C(document).find('input[name="post_id"][data-pafe-form-builder-hidden-form-id="'+g+'"]').eq(0).closest("[data-elementor-id]").data("elementor-id"),a=JSON.stringify(v);s(JSON.parse(e),t,g,a,i,o,k,C(this));n.clear()},error:function(){C(document).find('[data-pafe-form-builder-form-id="'+g+'"]').closest(".elementor-element").css({opacity:1}),l.css({opacity:1}),l.removeClass("elementor-form-waiting"),l.find(".pafe-form-builder-alert--stripe .elementor-message-danger").addClass("visible"),l.find("[data-pafe-form-builder-trigger-failed]").trigger("click"),n.clear()}}))})})})):o.createPaymentMethod("card",n,{}).then(function(e){e.error||(k.append("payment_method_id",e.paymentMethod.id),C.ajax({url:C("[data-pafe-ajax-url]").data("pafe-ajax-url"),type:"POST",data:k,processData:!1,contentType:!1,success:function(e){var t=C(document).find('input[name="post_id"][data-pafe-form-builder-hidden-form-id="'+g+'"]').eq(0).closest("[data-elementor-id]").data("elementor-id"),a=JSON.stringify(v);s(JSON.parse(e),t,g,a,i,o,k,C(this));n.clear()},error:function(){C(document).find('[data-pafe-form-builder-form-id="'+g+'"]').closest(".elementor-element").css({opacity:1}),l.css({opacity:1}),l.removeClass("elementor-form-waiting"),l.find(".pafe-form-builder-alert--stripe .elementor-message-danger").addClass("visible"),l.find("[data-pafe-form-builder-trigger-failed]").trigger("click"),n.clear()}}))}))}))})})}function s(t,a,i,r,d,l,o){t.error?f("failed",0,i,o,0,t):t.requires_action?t.subscriptions?l.handleCardPayment(t.payment_intent_client_secret).then(function(e){e.error||f("succeeded",0,i,o,0,t)}):l.handleCardAction(t.payment_intent_client_secret).then(function(e){e.error?f("failed",0,i,o,0,t):(o.delete("payment_method_id"),o.append("payment_intent_id",e.paymentIntent.id),n.ajax({url:n("[data-pafe-ajax-url]").data("pafe-ajax-url"),type:"POST",data:o,processData:!1,contentType:!1,success:function(e){s(JSON.parse(e),a,i,r,d,l,o)}}))}):f("succeeded",0,i,o,0,t)}function f(r,e,d,t,a,i){var l=n(document).find('[data-pafe-form-builder-submit-form-id="'+d+'"]').closest(".elementor-element");"failed"==r?(n(document).find('[data-pafe-form-builder-form-id="'+d+'"]').closest(".elementor-element").css({opacity:1}),l.css({opacity:1}),l.removeClass("elementor-form-waiting"),l.find(".pafe-form-builder-alert--stripe .elementor-message-danger").addClass("visible"),n(document).find('[data-pafe-form-builder-submit-form-id="'+d+'"]').closest(".elementor-element").css({opacity:1}),l.find("[data-pafe-form-builder-trigger-failed]").trigger("click")):(t.delete("stripeToken"),t.delete("action"),t.append("action","pafe_ajax_form_builder"),t.append("payment_intent_id",i.payment_intent_id),n.ajax({url:n("[data-pafe-ajax-url]").data("pafe-ajax-url"),type:"POST",data:t,processData:!1,contentType:!1,success:function(e){var t,a,i;n(document).find('[data-pafe-form-builder-form-id="'+d+'"]').closest(".elementor-element").css({opacity:1}),l.css({opacity:1}),l.removeClass("elementor-form-waiting"),-1!==(e=e.trim()).indexOf(",")&&((t=JSON.parse(e)).custom_message&&l.find("[data-pafe-form-builder-message]").html(t.custom_message),l.find(".elementor-message").each(function(){var e;""!=t.post_url&&(e=n(this).html().replace("[post_url]",'<a href="'+t.post_url+'">'+t.post_url+"</a>"),n(this).html(e))}),"succeeded"==r||"active"==r?(l.find(".pafe-form-builder-alert--stripe .elementor-message-success").addClass("visible"),l.find("[data-pafe-form-builder-trigger-success]").trigger("click")):(l.find(".pafe-form-builder-alert--stripe .elementor-message-danger").addClass("visible"),n(document).find('[data-pafe-form-builder-form-id="'+d+'"]').closest(".elementor-element").css({opacity:1}),n(document).find('[data-pafe-form-builder-submit-form-id="'+d+'"]').closest(".elementor-element").css({opacity:1}),l.find("[data-pafe-form-builder-trigger-failed]").trigger("click")),""!=t.status?l.find(".pafe-form-builder-alert--mail .elementor-message-success").addClass("visible"):(l.find(".pafe-form-builder-alert--mail .elementor-message-danger").addClass("visible"),n(document).find('[data-pafe-form-builder-form-id="'+d+'"]').closest(".elementor-element").css({opacity:1}),n(document).find('[data-pafe-form-builder-submit-form-id="'+d+'"]').closest(".elementor-element").css({opacity:1}),""!=t.register_message&&l.find(".pafe-form-builder-alert--mail .elementor-message-danger").html(t.register_message.replace(/###/g,","))),0!=l.find('input[name="redirect"]').length&&(a=l.find('input[name="redirect"]').val().trim(),i=l.find('input[name="redirect"]').attr("data-pafe-form-builder-open-new-tab"),-1!==e.indexOf(",")&&"1"!=t.failed_status&&(""!=t.post_url&&"[post_url]"==a?window.location.href=t.post_url:""!=t.redirect&&("yes"==i?window.open(t.redirect,"_blank"):window.location.href=t.redirect))),0!=n(document).find('[data-pafe-form-builder-popup][data-pafe-form-builder-hidden-form-id="'+d+'"]').length&&$submit.closest(".elementor-widget-container").find('[data-pafe-form-builder-hidden-form-id="'+d+'"]').trigger("click"),t.popup&&0!=n(document).find('[data-pafe-form-builder-popup-open][data-pafe-form-builder-hidden-form-id="'+d+'"]').length&&$submit.closest(".elementor-widget-container").find('[data-pafe-form-builder-hidden-form-id="'+d+'"]').trigger("click"),0!=n(document).find('[data-pafe-form-builder-popup-close][data-pafe-form-builder-hidden-form-id="'+d+'"]').length&&$submit.closest(".elementor-widget-container").find('[data-pafe-form-builder-hidden-form-id="'+d+'"]').trigger("click"))}}))}n(window).on("elementor/frontend/init",function(){elementorFrontend.hooks.addAction("frontend/element_ready/pafe-form-builder-field.default",e)})}(jQuery);